{"version":3,"file":"password-input.mjs","sources":["../../../../src/govuk/components/password-input/password-input.mjs"],"sourcesContent":["import { closestAttributeValue } from '../../common/closest-attribute-value.mjs'\nimport { mergeConfigs } from '../../common/index.mjs'\nimport { normaliseDataset } from '../../common/normalise-dataset.mjs'\nimport { ElementError } from '../../errors/index.mjs'\nimport { GOVUKFrontendComponent } from '../../govuk-frontend-component.mjs'\nimport { I18n } from '../../i18n.mjs'\n\n/**\n * Password input component\n *\n * @preserve\n */\nexport class PasswordInput extends GOVUKFrontendComponent {\n  /** @private */\n  $module\n\n  /**\n   * @private\n   * @type {PasswordInputConfig}\n   */\n  config\n\n  /** @private */\n  i18n\n\n  /**\n   * @private\n   * @type {HTMLInputElement}\n   */\n  $input\n\n  /**\n   * @private\n   * @type {HTMLButtonElement}\n   */\n  $showHideButton\n\n  /** @private */\n  $screenReaderStatusMessage\n\n  /**\n   * @param {Element | null} $module - HTML element to use for password input\n   * @param {PasswordInputConfig} [config] - Password input config\n   */\n  constructor($module, config = {}) {\n    super()\n\n    if (!($module instanceof HTMLElement)) {\n      throw new ElementError({\n        componentName: 'Password input',\n        element: $module,\n        identifier: 'Root element (`$module`)'\n      })\n    }\n\n    const $input = $module.querySelector('.govuk-js-password-input-input')\n    if (!($input instanceof HTMLInputElement)) {\n      throw new ElementError({\n        componentName: 'Password input',\n        element: $input,\n        expectedType: 'HTMLInputElement',\n        identifier: 'Form field (`.govuk-js-password-input-input`)'\n      })\n    }\n\n    if ($input.type !== 'password') {\n      throw new ElementError(\n        'Password input: Form field (`.govuk-js-password-input-input`) must be of type `password`.'\n      )\n    }\n\n    const $showHideButton = $module.querySelector(\n      '.govuk-js-password-input-toggle'\n    )\n    if (!($showHideButton instanceof HTMLButtonElement)) {\n      throw new ElementError({\n        componentName: 'Password input',\n        element: $showHideButton,\n        expectedType: 'HTMLButtonElement',\n        identifier: 'Button (`.govuk-js-password-input-toggle`)'\n      })\n    }\n\n    if ($showHideButton.type !== 'button') {\n      throw new ElementError(\n        'Password input: Button (`.govuk-js-password-input-toggle`) must be of type `button`.'\n      )\n    }\n\n    this.$module = $module\n    this.$input = $input\n    this.$showHideButton = $showHideButton\n\n    this.config = mergeConfigs(\n      PasswordInput.defaults,\n      config,\n      normaliseDataset(PasswordInput, $module.dataset)\n    )\n\n    this.i18n = new I18n(this.config.i18n, {\n      // Read the fallback if necessary rather than have it set in the defaults\n      locale: closestAttributeValue($module, 'lang')\n    })\n\n    // Show the toggle button element\n    this.$showHideButton.removeAttribute('hidden')\n\n    // Create and append the status text for screen readers.\n    // This is injected between the input and button so that users get a sensible reading order if\n    // moving through the page content linearly:\n    // [password input] -> [your password is visible/hidden] -> [show/hide password]\n    const $screenReaderStatusMessage = document.createElement('div')\n    $screenReaderStatusMessage.className =\n      'govuk-password-input__sr-status govuk-visually-hidden'\n    $screenReaderStatusMessage.setAttribute('aria-live', 'polite')\n    this.$screenReaderStatusMessage = $screenReaderStatusMessage\n    this.$input.insertAdjacentElement('afterend', $screenReaderStatusMessage)\n\n    // Bind toggle button\n    this.$showHideButton.addEventListener('click', this.toggle.bind(this))\n\n    // Bind event to revert the password visibility to hidden\n    if (this.$input.form) {\n      this.$input.form.addEventListener('submit', () => this.hide())\n    }\n\n    // If the page is restored from bfcache and the password is visible, hide it again\n    window.addEventListener('pageshow', (event) => {\n      if (event.persisted && this.$input.type !== 'password') {\n        this.hide()\n      }\n    })\n\n    // Default the component to having the password hidden.\n    this.hide()\n  }\n\n  /**\n   * Toggle the visibility of the password input\n   *\n   * @private\n   * @param {MouseEvent} event - Click event\n   */\n  toggle(event) {\n    event.preventDefault()\n\n    // If on this click, the field is type=\"password\", show the value\n    if (this.$input.type === 'password') {\n      this.show()\n      return\n    }\n\n    // Otherwise, hide it\n    // Being defensive - hiding should always be the default\n    this.hide()\n  }\n\n  /**\n   * Show the password input value in plain text.\n   *\n   * @private\n   */\n  show() {\n    this.setType('text')\n  }\n\n  /**\n   * Hide the password input value.\n   *\n   * @private\n   */\n  hide() {\n    this.setType('password')\n  }\n\n  /**\n   * Set the password input type\n   *\n   * @param {'text' | 'password'} type - Input type\n   * @private\n   */\n  setType(type) {\n    if (type === this.$input.type) {\n      return\n    }\n\n    // Update input type\n    this.$input.setAttribute('type', type)\n\n    const isHidden = type === 'password'\n    const prefixButton = isHidden ? 'show' : 'hide'\n    const prefixStatus = isHidden ? 'passwordHidden' : 'passwordShown'\n\n    // Update button text\n    this.$showHideButton.innerText = this.i18n.t(`${prefixButton}Password`)\n\n    // Update button aria-label\n    this.$showHideButton.setAttribute(\n      'aria-label',\n      this.i18n.t(`${prefixButton}PasswordAriaLabel`)\n    )\n\n    // Update status change text\n    this.$screenReaderStatusMessage.innerText = this.i18n.t(\n      `${prefixStatus}Announcement`\n    )\n  }\n\n  /**\n   * Name for the component used when initialising using data-module attributes.\n   */\n  static moduleName = 'govuk-password-input'\n\n  /**\n   * Password input default config\n   *\n   * @see {@link PasswordInputConfig}\n   * @constant\n   * @default\n   * @type {PasswordInputConfig}\n   */\n  static defaults = Object.freeze({\n    i18n: {\n      showPassword: 'Show',\n      hidePassword: 'Hide',\n      showPasswordAriaLabel: 'Show password',\n      hidePasswordAriaLabel: 'Hide password',\n      passwordShownAnnouncement: 'Your password is visible',\n      passwordHiddenAnnouncement: 'Your password is hidden'\n    }\n  })\n\n  /**\n   * Password input config schema\n   *\n   * @constant\n   * @satisfies {Schema}\n   */\n  static schema = Object.freeze({\n    properties: {\n      i18n: { type: 'object' }\n    }\n  })\n}\n\n/**\n * Password input config\n *\n * @typedef {object} PasswordInputConfig\n * @property {PasswordInputTranslations} [i18n=PasswordInput.defaults.i18n] - Password input translations\n */\n\n/**\n * Password input translations\n *\n * @see {@link PasswordInput.defaults.i18n}\n * @typedef {object} PasswordInputTranslations\n *\n * Messages displayed to the user indicating the state of the show/hide toggle.\n * @property {string} [showPassword] - Visible text of the button when the\n *   password is currently hidden. Plain text only.\n * @property {string} [hidePassword] - Visible text of the button when the\n *   password is currently visible. Plain text only.\n * @property {string} [showPasswordAriaLabel] - aria-label of the button when\n *   the password is currently hidden. Plain text only.\n * @property {string} [hidePasswordAriaLabel] - aria-label of the button when\n *   the password is currently visible. Plain text only.\n * @property {string} [passwordShownAnnouncement] - Screen reader\n *   announcement to make when the password has just become visible.\n *   Plain text only.\n * @property {string} [passwordHiddenAnnouncement] - Screen reader\n *   announcement to make when the password has just been hidden.\n *   Plain text only.\n */\n\n/**\n * @typedef {import('../../common/index.mjs').Schema} Schema\n * @typedef {import('../../i18n.mjs').TranslationPluralForms} TranslationPluralForms\n */\n"],"names":["PasswordInput","GOVUKFrontendComponent","constructor","$module","config","i18n","$input","$showHideButton","$screenReaderStatusMessage","HTMLElement","ElementError","componentName","element","identifier","querySelector","HTMLInputElement","expectedType","type","HTMLButtonElement","mergeConfigs","defaults","normaliseDataset","dataset","I18n","locale","closestAttributeValue","removeAttribute","document","createElement","className","setAttribute","insertAdjacentElement","addEventListener","toggle","bind","form","hide","window","event","persisted","preventDefault","show","setType","isHidden","prefixButton","prefixStatus","innerText","t","moduleName","Object","freeze","showPassword","hidePassword","showPasswordAriaLabel","hidePasswordAriaLabel","passwordShownAnnouncement","passwordHiddenAnnouncement","schema","properties"],"mappings":"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"}
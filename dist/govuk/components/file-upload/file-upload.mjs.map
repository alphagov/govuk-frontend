{"version":3,"file":"file-upload.mjs","sources":["../../../../src/govuk/components/file-upload/file-upload.mjs"],"sourcesContent":["import { closestAttributeValue } from '../../common/closest-attribute-value.mjs'\nimport { ConfigurableComponent } from '../../common/configuration.mjs'\nimport { formatErrorMessage } from '../../common/index.mjs'\nimport { ElementError } from '../../errors/index.mjs'\nimport { I18n } from '../../i18n.mjs'\n\n/**\n * File upload component\n *\n * @preserve\n * @augments ConfigurableComponent<FileUploadConfig,HTMLFileInputElement>\n */\nexport class FileUpload extends ConfigurableComponent {\n  /**\n   * @private\n   */\n  $wrapper\n\n  /**\n   * @private\n   */\n  $button\n\n  /**\n   * @private\n   */\n  $status\n\n  /** @private */\n  i18n\n\n  /** @private */\n  id\n\n  /**\n   * @param {Element | null} $root - File input element\n   * @param {FileUploadConfig} [config] - File Upload config\n   */\n  constructor($root, config = {}) {\n    super($root, config)\n\n    if (this.$root.type !== 'file') {\n      throw new ElementError(\n        formatErrorMessage(\n          FileUpload,\n          'Form field must be an input of type `file`.'\n        )\n      )\n    }\n\n    if (!this.$root.id.length) {\n      throw new ElementError(\n        formatErrorMessage(FileUpload, 'Form field must specify an `id`.')\n      )\n    }\n\n    this.id = this.$root.id\n\n    this.i18n = new I18n(this.config.i18n, {\n      // Read the fallback if necessary rather than have it set in the defaults\n      locale: closestAttributeValue(this.$root, 'lang')\n    })\n\n    const $label = this.findLabel()\n    $label.setAttribute('for', `${this.id}-input`)\n    // Add an ID to the label if it doesn't have one already\n    // so it can be referenced by `aria-labelledby`\n    if (!$label.id) {\n      $label.id = `${this.id}-label`\n    }\n\n    // we need to copy the 'id' of the root element\n    // to the new button replacement element\n    // so that focus will work in the error summary\n    this.$root.id = `${this.id}-input`\n\n    // Wrapping element. This defines the boundaries of our drag and drop area.\n    const $wrapper = document.createElement('div')\n    $wrapper.className = 'govuk-file-upload-wrapper'\n\n    // Create the file selection button\n    const $button = document.createElement('button')\n    $button.classList.add('govuk-file-upload__button')\n    $button.type = 'button'\n    $button.id = this.id\n\n    // Copy `aria-describedby` if present so hints and errors\n    // are associated to the `<button>`\n    const ariaDescribedBy = this.$root.getAttribute('aria-describedby')\n    if (ariaDescribedBy) {\n      $button.setAttribute('aria-describedby', ariaDescribedBy)\n    }\n\n    // Create status element that shows what/how many files are selected\n    const $status = document.createElement('span')\n    $status.className = 'govuk-body govuk-file-upload__status'\n    $status.innerText = this.i18n.t('filesSelectedDefault')\n    $status.classList.add('govuk-file-upload__status--empty')\n\n    $button.appendChild($status)\n\n    const commaSpan = document.createElement('span')\n    commaSpan.className = 'govuk-visually-hidden'\n    commaSpan.innerText = ', '\n    commaSpan.id = `${this.id}-comma`\n\n    $button.appendChild(commaSpan)\n\n    const containerSpan = document.createElement('span')\n    containerSpan.className = 'govuk-file-upload__pseudo-button-container'\n\n    const buttonSpan = document.createElement('span')\n    buttonSpan.className =\n      'govuk-button govuk-button--secondary govuk-file-upload__pseudo-button'\n    buttonSpan.innerText = this.i18n.t('selectFilesButton')\n\n    containerSpan.appendChild(buttonSpan)\n\n    const instructionSpan = document.createElement('span')\n    instructionSpan.className = 'govuk-body govuk-file-upload__instruction'\n    instructionSpan.innerText = this.i18n.t('instruction')\n\n    containerSpan.appendChild(instructionSpan)\n\n    $button.appendChild(containerSpan)\n    $button.setAttribute(\n      'aria-labelledby',\n      `${$label.id} ${commaSpan.id} ${$button.id}`\n    )\n    $button.addEventListener('click', this.onClick.bind(this))\n\n    // Assemble these all together\n    $wrapper.insertAdjacentElement('beforeend', $button)\n\n    // Inject all this *after* the native file input\n    this.$root.insertAdjacentElement('afterend', $wrapper)\n\n    this.$root.setAttribute('tabindex', '-1')\n    this.$root.setAttribute('aria-hidden', 'true')\n\n    // Move the native file input to inside of the wrapper\n    $wrapper.insertAdjacentElement('afterbegin', this.$root)\n\n    // Make all these new variables available to the module\n    this.$wrapper = $wrapper\n    this.$button = $button\n    this.$status = $status\n\n    // Bind change event to the underlying input\n    this.$root.addEventListener('change', this.onChange.bind(this))\n\n    // Synchronise the `disabled` state between the button and underlying input\n    this.updateDisabledState()\n    this.observeDisabledState()\n\n    // Handle drop zone visibility\n    // A live region to announce when users enter or leave the drop zone\n    this.$announcements = document.createElement('span')\n    this.$announcements.classList.add('govuk-file-upload-announcements')\n    this.$announcements.classList.add('govuk-visually-hidden')\n    this.$announcements.setAttribute('aria-live', 'assertive')\n    this.$wrapper.insertAdjacentElement('afterend', this.$announcements)\n\n    // The easy bit, when dropping hide the dropzone\n    //\n    // Note: the component relies on the native behaviour to get the files\n    // being dragged set as value of the `<input>`. This allows a `change`\n    // event to be automatically fired from the element and saves us from having\n    // to do anything more than hiding the dropzone on drop.\n    this.$wrapper.addEventListener('drop', this.hideDropZone.bind(this))\n\n    // While user is dragging, it gets a little more complex because of Safari.\n    // Safari doesn't fill `relatedTarget` on `dragleave` (nor `dragenter`).\n    // This means we can't use `relatedTarget` to:\n    // - check if the user is still within the wrapper\n    //   (`relatedTarget` being a descendant of the wrapper)\n    // - check if the user is still over the viewport\n    //   (`relatedTarget` being null if outside)\n\n    // Thanks to `dragenter` bubbling, we can listen on the `document` with a\n    // single function and update the visibility based on whether we entered a\n    // node inside or outside the wrapper.\n    document.addEventListener(\n      'dragenter',\n      this.updateDropzoneVisibility.bind(this)\n    )\n\n    // To detect if we're outside the document, we can track if there was a\n    // `dragenter` event preceding a `dragleave`. If there wasn't, this means\n    // we're outside the document.\n    //\n    // The order of events is guaranteed by the HTML specs:\n    // https://html.spec.whatwg.org/multipage/dnd.html#drag-and-drop-processing-model\n    document.addEventListener('dragenter', () => {\n      this.enteredAnotherElement = true\n    })\n\n    document.addEventListener('dragleave', () => {\n      if (!this.enteredAnotherElement) {\n        this.hideDropZone()\n      }\n\n      this.enteredAnotherElement = false\n    })\n  }\n\n  /**\n   * Updates the visibility of the dropzone as users enters the various elements on the page\n   *\n   * @param {DragEvent} event - The `dragenter` event\n   */\n  updateDropzoneVisibility(event) {\n    // DOM interfaces only type `event.target` as `EventTarget`\n    // so we first need to make sure it's a `Node`\n    if (event.target instanceof Node) {\n      if (this.$wrapper.contains(event.target)) {\n        if (event.dataTransfer && isContainingFiles(event.dataTransfer)) {\n          // Only update the class and make the announcement if not already visible\n          // to avoid repeated announcements on NVDA (2024.4) + Firefox (133)\n          if (\n            !this.$wrapper.classList.contains(\n              'govuk-file-upload-wrapper--show-dropzone'\n            )\n          ) {\n            this.$wrapper.classList.add(\n              'govuk-file-upload-wrapper--show-dropzone'\n            )\n            this.$announcements.innerText = this.i18n.t('dropZoneEntered')\n          }\n        }\n      } else {\n        // Only hide the dropzone if it is visible to prevent announcing user\n        // left the drop zone when they enter the page but haven't reached yet\n        // the file upload component\n        if (\n          this.$wrapper.classList.contains(\n            'govuk-file-upload-wrapper--show-dropzone'\n          )\n        ) {\n          this.hideDropZone()\n        }\n      }\n    }\n  }\n\n  /**\n   * Hides the dropzone once user has dropped files on the `<input>`\n   */\n  hideDropZone() {\n    this.$wrapper.classList.remove('govuk-file-upload-wrapper--show-dropzone')\n    this.$announcements.innerText = this.i18n.t('dropZoneLeft')\n  }\n\n  /**\n   * Check if the value of the underlying input has changed\n   */\n  onChange() {\n    const fileCount = this.$root.files.length\n\n    if (fileCount === 0) {\n      // If there are no files, show the default selection text\n      this.$status.innerText = this.i18n.t('filesSelectedDefault')\n      this.$status.classList.add('govuk-file-upload__status--empty')\n    } else {\n      if (\n        // If there is 1 file, just show the file name\n        fileCount === 1\n      ) {\n        this.$status.innerText = this.$root.files[0].name\n      } else {\n        // Otherwise, tell the user how many files are selected\n        this.$status.innerText = this.i18n.t('filesSelected', {\n          count: fileCount\n        })\n      }\n\n      this.$status.classList.remove('govuk-file-upload__status--empty')\n    }\n  }\n\n  /**\n   * Looks up the `<label>` element associated to the field\n   *\n   * @private\n   * @returns {HTMLElement} The `<label>` element associated to the field\n   * @throws {ElementError} If the `<label>` cannot be found\n   */\n  findLabel() {\n    // Use `label` in the selector so TypeScript knows the type fo `HTMLElement`\n    const $label = document.querySelector(`label[for=\"${this.$root.id}\"]`)\n\n    if (!$label) {\n      throw new ElementError({\n        component: FileUpload,\n        identifier: 'No label'\n      })\n    }\n\n    return $label\n  }\n\n  /**\n   * When the button is clicked, emulate clicking the actual, hidden file input\n   */\n  onClick() {\n    this.$root.click()\n  }\n\n  /**\n   * Create a mutation observer to check if the input's attributes altered.\n   */\n  observeDisabledState() {\n    const observer = new MutationObserver((mutationList) => {\n      for (const mutation of mutationList) {\n        console.log('mutation', mutation)\n        if (\n          mutation.type === 'attributes' &&\n          mutation.attributeName === 'disabled'\n        ) {\n          this.updateDisabledState()\n        }\n      }\n    })\n\n    observer.observe(this.$root, {\n      attributes: true\n    })\n  }\n\n  /**\n   * Synchronise the `disabled` state between the input and replacement button.\n   */\n  updateDisabledState() {\n    this.$button.disabled = this.$root.disabled\n  }\n\n  /**\n   * Name for the component used when initialising using data-module attributes.\n   */\n  static moduleName = 'govuk-file-upload'\n\n  /**\n   * File upload default config\n   *\n   * @see {@link FileUploadConfig}\n   * @constant\n   * @type {FileUploadConfig}\n   */\n  static defaults = Object.freeze({\n    i18n: {\n      selectFilesButton: 'Choose file',\n      filesSelectedDefault: 'No file chosen',\n      filesSelected: {\n        // the 'one' string isn't used as the component displays the filename\n        // instead, however it's here for coverage's sake\n        one: '%{count} file chosen',\n        other: '%{count} files chosen'\n      },\n      dropZoneEntered: 'Entered drop zone',\n      dropZoneLeft: 'Left drop zone',\n      instruction: 'or drop file'\n    }\n  })\n\n  /**\n   * File upload config schema\n   *\n   * @constant\n   * @satisfies {Schema}\n   */\n  static schema = Object.freeze({\n    properties: {\n      i18n: { type: 'object' }\n    }\n  })\n}\n\n/**\n * Checks if the given `DataTransfer` contains files\n *\n * @internal\n * @param {DataTransfer} dataTransfer - The `DataTransfer` to check\n * @returns {boolean} - `true` if it contains files or we can't infer it, `false` otherwise\n */\nfunction isContainingFiles(dataTransfer) {\n  // Safari sometimes does not provide info about types :'(\n  // In which case best not to assume anything and try to set the files\n  const hasNoTypesInfo = dataTransfer.types.length === 0\n\n  // When dragging images, there's a mix of mime types + Files\n  // which we can't assign to the native input\n  const isDraggingFiles = dataTransfer.types.some((type) => type === 'Files')\n\n  return hasNoTypesInfo || isDraggingFiles\n}\n\n/**\n * @typedef {HTMLInputElement & {files: FileList}} HTMLFileInputElement\n */\n\n/**\n * File upload config\n *\n * @see {@link FileUpload.defaults}\n * @typedef {object} FileUploadConfig\n * @property {FileUploadTranslations} [i18n=FileUpload.defaults.i18n] - File upload translations\n */\n\n/**\n * File upload translations\n *\n * @see {@link FileUpload.defaults.i18n}\n * @typedef {object} FileUploadTranslations\n *\n * Messages used by the component\n * @property {string} [selectFiles] - Text of button that opens file browser\n * @property {TranslationPluralForms} [filesSelected] - Text indicating how\n *   many files have been selected\n * @property {string} [dropZoneEntered] - Text announced to assistive technology\n *   when users entered the drop zone while dragging\n * @property {string} [dropZoneLeft] - Text announced to assistive technology\n *   when users left the drop zone while dragging\n */\n\n/**\n * @typedef {import('../../common/configuration.mjs').Schema} Schema\n * @typedef {import('../../i18n.mjs').TranslationPluralForms} TranslationPluralForms\n */\n"],"names":["FileUpload","ConfigurableComponent","constructor","$root","config","$wrapper","$button","$status","i18n","id","type","ElementError","formatErrorMessage","length","I18n","locale","closestAttributeValue","$label","findLabel","setAttribute","document","createElement","className","classList","add","ariaDescribedBy","getAttribute","innerText","t","appendChild","commaSpan","containerSpan","buttonSpan","instructionSpan","addEventListener","onClick","bind","insertAdjacentElement","onChange","updateDisabledState","observeDisabledState","$announcements","hideDropZone","updateDropzoneVisibility","enteredAnotherElement","event","target","Node","contains","dataTransfer","isContainingFiles","remove","fileCount","files","name","count","querySelector","component","identifier","click","observer","MutationObserver","mutationList","mutation","console","log","attributeName","observe","attributes","disabled","moduleName","defaults","Object","freeze","selectFilesButton","filesSelectedDefault","filesSelected","one","other","dropZoneEntered","dropZoneLeft","instruction","schema","properties","hasNoTypesInfo","types","isDraggingFiles","some"],"mappings":"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"}
{"version":3,"file":"file-upload.mjs","sources":["../../../../src/govuk/components/file-upload/file-upload.mjs"],"sourcesContent":["import { closestAttributeValue } from '../../common/closest-attribute-value.mjs'\nimport { ConfigurableComponent } from '../../common/configuration.mjs'\nimport { formatErrorMessage } from '../../common/index.mjs'\nimport { ElementError } from '../../errors/index.mjs'\nimport { I18n } from '../../i18n.mjs'\n\n/**\n * File upload component\n *\n * @preserve\n * @augments ConfigurableComponent<FileUploadConfig>\n */\nexport class FileUpload extends ConfigurableComponent {\n  /**\n   * @private\n   * @type {HTMLFileInputElement}\n   */\n  $input\n\n  /**\n   * @private\n   */\n  $button\n\n  /**\n   * @private\n   */\n  $status\n\n  /** @private */\n  i18n\n\n  /** @private */\n  id\n\n  /** @private */\n  $announcements\n\n  /**\n   * @private\n   * @type {boolean | undefined}\n   */\n  enteredAnotherElement\n\n  /**\n   * @param {Element | null} $root - File input element\n   * @param {FileUploadConfig} [config] - File Upload config\n   */\n  constructor($root, config = {}) {\n    super($root, config)\n\n    const $input = this.$root.querySelector('input')\n\n    if ($input === null) {\n      throw new ElementError({\n        component: FileUpload,\n        identifier: 'File inputs (`<input type=\"file\">`)'\n      })\n    }\n\n    if ($input.type !== 'file') {\n      throw new ElementError(\n        formatErrorMessage(\n          FileUpload,\n          'File input (`<input type=\"file\">`) attribute (`type`) is not `file`'\n        )\n      )\n    }\n\n    this.$input = /** @type {HTMLFileInputElement} */ ($input)\n    this.$input.setAttribute('hidden', 'true')\n\n    if (!this.$input.id) {\n      throw new ElementError({\n        component: FileUpload,\n        identifier: 'File input (`<input type=\"file\">`) attribute (`id`)'\n      })\n    }\n\n    this.id = this.$input.id\n\n    this.i18n = new I18n(this.config.i18n, {\n      // Read the fallback if necessary rather than have it set in the defaults\n      locale: closestAttributeValue(this.$root, 'lang')\n    })\n\n    const $label = this.findLabel()\n    // Add an ID to the label if it doesn't have one already\n    // so it can be referenced by `aria-labelledby`\n    if (!$label.id) {\n      $label.id = `${this.id}-label`\n    }\n\n    // we need to copy the 'id' of the root element\n    // to the new button replacement element\n    // so that focus will work in the error summary\n    this.$input.id = `${this.id}-input`\n\n    // Create the file selection button\n    const $button = document.createElement('button')\n    $button.classList.add('govuk-file-upload-button')\n    $button.type = 'button'\n    $button.id = this.id\n    $button.classList.add('govuk-file-upload-button--empty')\n\n    // Copy `aria-describedby` if present so hints and errors\n    // are associated to the `<button>`\n    const ariaDescribedBy = this.$input.getAttribute('aria-describedby')\n    if (ariaDescribedBy) {\n      $button.setAttribute('aria-describedby', ariaDescribedBy)\n    }\n\n    // Create status element that shows what/how many files are selected\n    const $status = document.createElement('span')\n    $status.className = 'govuk-body govuk-file-upload-button__status'\n    $status.setAttribute('aria-live', 'polite')\n    $status.innerText = this.i18n.t('noFileChosen')\n\n    $button.appendChild($status)\n\n    const commaSpan = document.createElement('span')\n    commaSpan.className = 'govuk-visually-hidden'\n    commaSpan.innerText = ', '\n    commaSpan.id = `${this.id}-comma`\n\n    $button.appendChild(commaSpan)\n\n    const containerSpan = document.createElement('span')\n    containerSpan.className =\n      'govuk-file-upload-button__pseudo-button-container'\n\n    const buttonSpan = document.createElement('span')\n    buttonSpan.className =\n      'govuk-button govuk-button--secondary govuk-file-upload-button__pseudo-button'\n    buttonSpan.innerText = this.i18n.t('chooseFilesButton')\n\n    containerSpan.appendChild(buttonSpan)\n\n    // Add a space so the button and instruction read correctly\n    // when CSS is disabled\n    containerSpan.insertAdjacentText('beforeend', ' ')\n\n    const instructionSpan = document.createElement('span')\n    instructionSpan.className =\n      'govuk-body govuk-file-upload-button__instruction'\n    instructionSpan.innerText = this.i18n.t('dropInstruction')\n\n    containerSpan.appendChild(instructionSpan)\n\n    $button.appendChild(containerSpan)\n    $button.setAttribute(\n      'aria-labelledby',\n      `${$label.id} ${commaSpan.id} ${$button.id}`\n    )\n    $button.addEventListener('click', this.onClick.bind(this))\n    $button.addEventListener('dragover', (event) => {\n      // prevent default to allow drop\n      event.preventDefault()\n    })\n\n    // Assemble these all together\n    this.$root.insertAdjacentElement('afterbegin', $button)\n\n    this.$input.setAttribute('tabindex', '-1')\n    this.$input.setAttribute('aria-hidden', 'true')\n\n    // Make all these new variables available to the module\n    this.$button = $button\n    this.$status = $status\n\n    // Bind change event to the underlying input\n    this.$input.addEventListener('change', this.onChange.bind(this))\n\n    // Synchronise the `disabled` state between the button and underlying input\n    this.updateDisabledState()\n    this.observeDisabledState()\n\n    // Handle drop zone visibility\n    // A live region to announce when users enter or leave the drop zone\n    this.$announcements = document.createElement('span')\n    this.$announcements.classList.add('govuk-file-upload-announcements')\n    this.$announcements.classList.add('govuk-visually-hidden')\n    this.$announcements.setAttribute('aria-live', 'assertive')\n    this.$root.insertAdjacentElement('afterend', this.$announcements)\n\n    // if there is no CSS and input is hidden\n    // button will need to handle drop event\n    this.$button.addEventListener('drop', this.onDrop.bind(this))\n\n    // While user is dragging, it gets a little more complex because of Safari.\n    // Safari doesn't fill `relatedTarget` on `dragleave` (nor `dragenter`).\n    // This means we can't use `relatedTarget` to:\n    // - check if the user is still within the wrapper\n    //   (`relatedTarget` being a descendant of the wrapper)\n    // - check if the user is still over the viewport\n    //   (`relatedTarget` being null if outside)\n\n    // Thanks to `dragenter` bubbling, we can listen on the `document` with a\n    // single function and update the visibility based on whether we entered a\n    // node inside or outside the wrapper.\n    document.addEventListener(\n      'dragenter',\n      this.updateDropzoneVisibility.bind(this)\n    )\n\n    // To detect if we're outside the document, we can track if there was a\n    // `dragenter` event preceding a `dragleave`. If there wasn't, this means\n    // we're outside the document.\n    //\n    // The order of events is guaranteed by the HTML specs:\n    // https://html.spec.whatwg.org/multipage/dnd.html#drag-and-drop-processing-model\n    document.addEventListener('dragenter', () => {\n      this.enteredAnotherElement = true\n    })\n\n    document.addEventListener('dragleave', () => {\n      if (!this.enteredAnotherElement && !this.$button.disabled) {\n        this.hideDraggingState()\n        this.$announcements.innerText = this.i18n.t('leftDropZone')\n      }\n\n      this.enteredAnotherElement = false\n    })\n  }\n\n  /**\n   * Updates the visibility of the dropzone as users enters the various elements on the page\n   *\n   * @private\n   * @param {DragEvent} event - The `dragenter` event\n   */\n  updateDropzoneVisibility(event) {\n    if (this.$button.disabled) return\n\n    // DOM interfaces only type `event.target` as `EventTarget`\n    // so we first need to make sure it's a `Node`\n    if (event.target instanceof Node) {\n      if (this.$root.contains(event.target)) {\n        if (event.dataTransfer && isContainingFiles(event.dataTransfer)) {\n          // Only update the class and make the announcement if not already visible\n          // to avoid repeated announcements on NVDA (2024.4) + Firefox (133)\n          if (\n            !this.$button.classList.contains(\n              'govuk-file-upload-button--dragging'\n            )\n          ) {\n            this.showDraggingState()\n            this.$announcements.innerText = this.i18n.t('enteredDropZone')\n          }\n        }\n      } else {\n        // Only hide the dropzone if it is visible to prevent announcing user\n        // left the drop zone when they enter the page but haven't reached yet\n        // the file upload component\n        if (\n          this.$button.classList.contains('govuk-file-upload-button--dragging')\n        ) {\n          this.hideDraggingState()\n          this.$announcements.innerText = this.i18n.t('leftDropZone')\n        }\n      }\n    }\n  }\n\n  /**\n   * Show the drop zone visually\n   *\n   * @private\n   */\n  showDraggingState() {\n    this.$button.classList.add('govuk-file-upload-button--dragging')\n  }\n\n  /**\n   * Hides the drop zone visually\n   *\n   * @private\n   */\n  hideDraggingState() {\n    this.$button.classList.remove('govuk-file-upload-button--dragging')\n  }\n\n  /**\n   * Handles user dropping on the component\n   *\n   * @private\n   * @param {DragEvent} event - The `dragenter` event\n   */\n  onDrop(event) {\n    event.preventDefault()\n\n    if (event.dataTransfer && isContainingFiles(event.dataTransfer)) {\n      this.$input.files = event.dataTransfer.files\n\n      // Dispatch a `change` event so external code that would rely on the `<input>`\n      // dispatching an event when files are dropped still work.\n      // Use a `CustomEvent` so our events are distinguishable from browser's native events\n      this.$input.dispatchEvent(new CustomEvent('change'))\n\n      this.hideDraggingState()\n    }\n  }\n\n  /**\n   * Check if the value of the underlying input has changed\n   *\n   * @private\n   */\n  onChange() {\n    const fileCount = this.$input.files.length\n\n    if (fileCount === 0) {\n      // If there are no files, show the default selection text\n      this.$status.innerText = this.i18n.t('noFileChosen')\n      this.$button.classList.add('govuk-file-upload-button--empty')\n    } else {\n      if (\n        // If there is 1 file, just show the file name\n        fileCount === 1\n      ) {\n        this.$status.innerText = this.$input.files[0].name\n      } else {\n        // Otherwise, tell the user how many files are selected\n        this.$status.innerText = this.i18n.t('multipleFilesChosen', {\n          count: fileCount\n        })\n      }\n\n      this.$button.classList.remove('govuk-file-upload-button--empty')\n    }\n  }\n\n  /**\n   * Looks up the `<label>` element associated to the field\n   *\n   * @private\n   * @returns {HTMLElement} The `<label>` element associated to the field\n   * @throws {ElementError} If the `<label>` cannot be found\n   */\n  findLabel() {\n    // Use `label` in the selector so TypeScript knows the type fo `HTMLElement`\n    const $label = document.querySelector(`label[for=\"${this.$input.id}\"]`)\n\n    if (!$label) {\n      throw new ElementError({\n        component: FileUpload,\n        identifier: `Field label (\\`<label for=${this.$input.id}>\\`)`\n      })\n    }\n\n    return $label\n  }\n\n  /**\n   * When the button is clicked, emulate clicking the actual, hidden file input\n   *\n   * @private\n   */\n  onClick() {\n    this.$input.click()\n  }\n\n  /**\n   * Create a mutation observer to check if the input's attributes altered.\n   *\n   * @private\n   */\n  observeDisabledState() {\n    const observer = new MutationObserver((mutationList) => {\n      for (const mutation of mutationList) {\n        if (\n          mutation.type === 'attributes' &&\n          mutation.attributeName === 'disabled'\n        ) {\n          this.updateDisabledState()\n        }\n      }\n    })\n\n    observer.observe(this.$input, {\n      attributes: true\n    })\n  }\n\n  /**\n   * Synchronise the `disabled` state between the input and replacement button.\n   *\n   * @private\n   */\n  updateDisabledState() {\n    this.$button.disabled = this.$input.disabled\n\n    this.$root.classList.toggle(\n      'govuk-drop-zone--disabled',\n      this.$button.disabled\n    )\n  }\n\n  /**\n   * Name for the component used when initialising using data-module attributes.\n   */\n  static moduleName = 'govuk-file-upload'\n\n  /**\n   * File upload default config\n   *\n   * @see {@link FileUploadConfig}\n   * @constant\n   * @type {FileUploadConfig}\n   */\n  static defaults = Object.freeze({\n    i18n: {\n      chooseFilesButton: 'Choose file',\n      dropInstruction: 'or drop file',\n      noFileChosen: 'No file chosen',\n      multipleFilesChosen: {\n        // the 'one' string isn't used as the component displays the filename\n        // instead, however it's here for coverage's sake\n        one: '%{count} file chosen',\n        other: '%{count} files chosen'\n      },\n      enteredDropZone: 'Entered drop zone',\n      leftDropZone: 'Left drop zone'\n    }\n  })\n\n  /**\n   * File upload config schema\n   *\n   * @constant\n   * @satisfies {Schema<FileUploadConfig>}\n   */\n  static schema = Object.freeze({\n    properties: {\n      i18n: { type: 'object' }\n    }\n  })\n}\n\n/**\n * Checks if the given `DataTransfer` contains files\n *\n * @internal\n * @param {DataTransfer} dataTransfer - The `DataTransfer` to check\n * @returns {boolean} - `true` if it contains files or we can't infer it, `false` otherwise\n */\nfunction isContainingFiles(dataTransfer) {\n  // Safari sometimes does not provide info about types :'(\n  // In which case best not to assume anything and try to set the files\n  const hasNoTypesInfo = dataTransfer.types.length === 0\n\n  // When dragging images, there's a mix of mime types + Files\n  // which we can't assign to the native input\n  const isDraggingFiles = dataTransfer.types.some((type) => type === 'Files')\n\n  return hasNoTypesInfo || isDraggingFiles\n}\n\n/**\n * @typedef {HTMLInputElement & {files: FileList}} HTMLFileInputElement\n */\n\n/**\n * File upload config\n *\n * @see {@link FileUpload.defaults}\n * @typedef {object} FileUploadConfig\n * @property {FileUploadTranslations} [i18n=FileUpload.defaults.i18n] - File upload translations\n */\n\n/**\n * File upload translations\n *\n * @see {@link FileUpload.defaults.i18n}\n * @typedef {object} FileUploadTranslations\n *\n * Messages used by the component\n * @property {string} [chooseFile] - The text of the button that opens the file picker\n * @property {string} [dropInstruction] - The text informing users they can drop files\n * @property {TranslationPluralForms} [multipleFilesChosen] - The text displayed when multiple files\n *   have been chosen by the user\n * @property {string} [noFileChosen] - The text to displayed when no file has been chosen by the user\n * @property {string} [enteredDropZone] - The text announced by assistive technology\n *   when user drags files and enters the drop zone\n * @property {string} [leftDropZone] - The text announced by assistive technology\n *   when user drags files and leaves the drop zone without dropping\n */\n\n/**\n * @import { Schema } from '../../common/configuration.mjs'\n * @import { TranslationPluralForms } from '../../i18n.mjs'\n */\n"],"names":["FileUpload","ConfigurableComponent","constructor","$root","config","$input","$button","$status","i18n","id","$announcements","enteredAnotherElement","querySelector","ElementError","component","identifier","type","formatErrorMessage","setAttribute","I18n","locale","closestAttributeValue","$label","findLabel","document","createElement","classList","add","ariaDescribedBy","getAttribute","className","innerText","t","appendChild","commaSpan","containerSpan","buttonSpan","insertAdjacentText","instructionSpan","addEventListener","onClick","bind","event","preventDefault","insertAdjacentElement","onChange","updateDisabledState","observeDisabledState","onDrop","updateDropzoneVisibility","disabled","hideDraggingState","target","Node","contains","dataTransfer","isContainingFiles","showDraggingState","remove","files","dispatchEvent","CustomEvent","fileCount","length","name","count","click","observer","MutationObserver","mutationList","mutation","attributeName","observe","attributes","toggle","moduleName","defaults","Object","freeze","chooseFilesButton","dropInstruction","noFileChosen","multipleFilesChosen","one","other","enteredDropZone","leftDropZone","schema","properties","hasNoTypesInfo","types","isDraggingFiles","some"],"mappings":"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"}
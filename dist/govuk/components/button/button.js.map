{"version":3,"file":"button.js","sources":["../../../../src/govuk/common/index.mjs","../../../../src/govuk/common/normalise-dataset.mjs","../../../../src/govuk/components/button/button.mjs"],"sourcesContent":["/**\n * Common helpers which do not require polyfill.\n *\n * IMPORTANT: If a helper require a polyfill, please isolate it in its own module\n * so that the polyfill can be properly tree-shaken and does not burden\n * the components that do not need that helper\n *\n * @module common/index\n */\n\n/**\n * Used to generate a unique string, allows multiple instances of the component\n * without them conflicting with each other.\n * https://stackoverflow.com/a/8809472\n *\n * @deprecated Will be made private in v5.0\n * @returns {string} Unique ID\n */\nexport function generateUniqueID () {\n  var d = new Date().getTime()\n  if (typeof window.performance !== 'undefined' && typeof window.performance.now === 'function') {\n    d += window.performance.now() // use high-precision timer if available\n  }\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = (d + Math.random() * 16) % 16 | 0\n    d = Math.floor(d / 16)\n    return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16)\n  })\n}\n\n/**\n * Config flattening function\n *\n * Takes any number of objects, flattens them into namespaced key-value pairs,\n * (e.g. \\{'i18n.showSection': 'Show section'\\}) and combines them together, with\n * greatest priority on the LAST item passed in.\n *\n * @deprecated Will be made private in v5.0\n * @returns {{ [key: string]: unknown }} A flattened object of key-value pairs.\n */\nexport function mergeConfigs (/* configObject1, configObject2, ...configObjects */) {\n  /**\n   * Function to take nested objects and flatten them to a dot-separated keyed\n   * object. Doing this means we don't need to do any deep/recursive merging of\n   * each of our objects, nor transform our dataset from a flat list into a\n   * nested object.\n   *\n   * @param {{ [key: string]: unknown }} configObject - Deeply nested object\n   * @returns {{ [key: string]: unknown }} Flattened object with dot-separated keys\n   */\n  var flattenObject = function (configObject) {\n    // Prepare an empty return object\n    /** @type {{ [key: string]: unknown }} */\n    var flattenedObject = {}\n\n    /**\n     * Our flattening function, this is called recursively for each level of\n     * depth in the object. At each level we prepend the previous level names to\n     * the key using `prefix`.\n     *\n     * @param {Partial<{ [key: string]: unknown }>} obj - Object to flatten\n     * @param {string} [prefix] - Optional dot-separated prefix\n     */\n    var flattenLoop = function (obj, prefix) {\n      // Loop through keys...\n      for (var key in obj) {\n        // Check to see if this is a prototypical key/value,\n        // if it is, skip it.\n        if (!Object.prototype.hasOwnProperty.call(obj, key)) {\n          continue\n        }\n        var value = obj[key]\n        var prefixedKey = prefix ? prefix + '.' + key : key\n        if (typeof value === 'object') {\n          // If the value is a nested object, recurse over that too\n          flattenLoop(value, prefixedKey)\n        } else {\n          // Otherwise, add this value to our return object\n          flattenedObject[prefixedKey] = value\n        }\n      }\n    }\n\n    // Kick off the recursive loop\n    flattenLoop(configObject)\n    return flattenedObject\n  }\n\n  // Start with an empty object as our base\n  /** @type {{ [key: string]: unknown }} */\n  var formattedConfigObject = {}\n\n  // Loop through each of the remaining passed objects and push their keys\n  // one-by-one into configObject. Any duplicate keys will override the existing\n  // key with the new value.\n  for (var i = 0; i < arguments.length; i++) {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument -- Ignore mismatch between arguments types\n    var obj = flattenObject(arguments[i])\n    for (var key in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, key)) {\n        formattedConfigObject[key] = obj[key]\n      }\n    }\n  }\n\n  return formattedConfigObject\n}\n\n/**\n * Extracts keys starting with a particular namespace from a flattened config\n * object, removing the namespace in the process.\n *\n * @deprecated Will be made private in v5.0\n * @param {{ [key: string]: unknown }} configObject - The object to extract key-value pairs from.\n * @param {string} namespace - The namespace to filter keys with.\n * @returns {{ [key: string]: unknown }} Flattened object with dot-separated key namespace removed\n * @throws {Error} Config object required\n * @throws {Error} Namespace string required\n */\nexport function extractConfigByNamespace (configObject, namespace) {\n  // Check we have what we need\n  if (!configObject || typeof configObject !== 'object') {\n    throw new Error('Provide a `configObject` of type \"object\".')\n  }\n\n  if (!namespace || typeof namespace !== 'string') {\n    throw new Error('Provide a `namespace` of type \"string\" to filter the `configObject` by.')\n  }\n\n  /** @type {{ [key: string]: unknown }} */\n  var newObject = {}\n\n  for (var key in configObject) {\n    // Split the key into parts, using . as our namespace separator\n    var keyParts = key.split('.')\n    // Check if the first namespace matches the configured namespace\n    if (Object.prototype.hasOwnProperty.call(configObject, key) && keyParts[0] === namespace) {\n      // Remove the first item (the namespace) from the parts array,\n      // but only if there is more than one part (we don't want blank keys!)\n      if (keyParts.length > 1) {\n        keyParts.shift()\n      }\n      // Join the remaining parts back together\n      var newKey = keyParts.join('.')\n      // Add them to our new object\n      newObject[newKey] = configObject[key]\n    }\n  }\n  return newObject\n}\n","/**\n * Normalise string\n *\n * 'If it looks like a duck, and it quacks like a duckâ€¦' ðŸ¦†\n *\n * If the passed value looks like a boolean or a number, convert it to a boolean\n * or number.\n *\n * Designed to be used to convert config passed via data attributes (which are\n * always strings) into something sensible.\n *\n * @deprecated Will be made private in v5.0\n * @param {string} value - The value to normalise\n * @returns {string | boolean | number | undefined} Normalised data\n */\nexport function normaliseString (value) {\n  if (typeof value !== 'string') {\n    return value\n  }\n\n  var trimmedValue = value.trim()\n\n  if (trimmedValue === 'true') {\n    return true\n  }\n\n  if (trimmedValue === 'false') {\n    return false\n  }\n\n  // Empty / whitespace-only strings are considered finite so we need to check\n  // the length of the trimmed string as well\n  if (trimmedValue.length > 0 && isFinite(Number(trimmedValue))) {\n    return Number(trimmedValue)\n  }\n\n  return value\n}\n\n/**\n * Normalise dataset\n *\n * Loop over an object and normalise each value using normaliseData function\n *\n * @deprecated Will be made private in v5.0\n * @param {DOMStringMap} dataset - HTML element dataset\n * @returns {{ [key: string]: unknown }} Normalised dataset\n */\nexport function normaliseDataset (dataset) {\n  /** @type {{ [key: string]: unknown }} */\n  var out = {}\n\n  for (var key in dataset) {\n    out[key] = normaliseString(dataset[key])\n  }\n\n  return out\n}\n","import { mergeConfigs } from '../../common/index.mjs'\nimport { normaliseDataset } from '../../common/normalise-dataset.mjs'\n\nvar KEY_SPACE = 32\nvar DEBOUNCE_TIMEOUT_IN_SECONDS = 1\n\n/**\n * JavaScript enhancements for the Button component\n *\n * @class\n * @param {Element} $module - HTML element to use for button\n * @param {ButtonConfig} [config] - Button config\n */\nfunction Button ($module, config) {\n  if (!($module instanceof HTMLElement)) {\n    return this\n  }\n\n  /** @deprecated Will be made private in v5.0 */\n  this.$module = $module\n\n  /** @deprecated Will be made private in v5.0 */\n  this.debounceFormSubmitTimer = null\n\n  /** @type {ButtonConfig} */\n  var defaultConfig = {\n    preventDoubleClick: false\n  }\n\n  /**\n   * @deprecated Will be made private in v5.0\n   * @type {ButtonConfig}\n   */\n  this.config = mergeConfigs(\n    defaultConfig,\n    config || {},\n    normaliseDataset($module.dataset)\n  )\n}\n\n/**\n * Initialise component\n */\nButton.prototype.init = function () {\n  // Check that required elements are present\n  if (!this.$module) {\n    return\n  }\n\n  this.$module.addEventListener('keydown', this.handleKeyDown)\n  this.$module.addEventListener('click', this.debounce.bind(this))\n}\n\n/**\n * Trigger a click event when the space key is pressed\n *\n * Some screen readers tell users they can activate things with the 'button'\n * role, so we need to match the functionality of native HTML buttons\n *\n * See https://github.com/alphagov/govuk_elements/pull/272#issuecomment-233028270\n *\n * @deprecated Will be made private in v5.0\n * @param {KeyboardEvent} event - Keydown event\n */\nButton.prototype.handleKeyDown = function (event) {\n  var $target = event.target\n\n  // Handle space bar only\n  if (event.keyCode !== KEY_SPACE) {\n    return\n  }\n\n  // Handle elements with [role=\"button\"] only\n  if ($target instanceof HTMLElement && $target.getAttribute('role') === 'button') {\n    event.preventDefault() // prevent the page from scrolling\n    $target.click()\n  }\n}\n\n/**\n * Debounce double-clicks\n *\n * If the click quickly succeeds a previous click then nothing will happen. This\n * stops people accidentally causing multiple form submissions by double\n * clicking buttons.\n *\n * @deprecated Will be made private in v5.0\n * @param {MouseEvent} event - Mouse click event\n * @returns {undefined | false} Returns undefined, or false when debounced\n */\nButton.prototype.debounce = function (event) {\n  // Check the button that was clicked has preventDoubleClick enabled\n  if (!this.config.preventDoubleClick) {\n    return\n  }\n\n  // If the timer is still running, prevent the click from submitting the form\n  if (this.debounceFormSubmitTimer) {\n    event.preventDefault()\n    return false\n  }\n\n  this.debounceFormSubmitTimer = setTimeout(/** @this {Button} */ function () {\n    this.debounceFormSubmitTimer = null\n  }.bind(this), DEBOUNCE_TIMEOUT_IN_SECONDS * 1000)\n}\n\nexport default Button\n\n/**\n * Button config\n *\n * @typedef {object} ButtonConfig\n * @property {boolean} [preventDoubleClick=false] - Prevent accidental double\n *   clicks on submit buttons from submitting forms multiple times.\n */\n"],"names":[],"mappings":"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"}